<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product - Kebun Rakyat</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body { background: linear-gradient(to bottom right, #fef3c7, #ffffff, #d1fae5); }
    
    /* Navigation - Mobile First */
    nav { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); padding: 12px 16px; }
    .nav-content { max-width: 1280px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
    .logo { display: flex; align-items: center; gap: 8px; text-decoration: none; }
    .logo-icon { width: 40px; height: 40px; background: linear-gradient(to bottom right, #16a34a, #10b981); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
    .logo-text h1 { font-size: 16px; font-weight: 700; background: linear-gradient(to right, #15803d, #059669); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-family: Georgia, serif; }
    .logo-text p { font-size: 7px; color: #16a34a; font-weight: 600; letter-spacing: 1.2px; }
    .btn { padding: 10px 18px; border-radius: 24px; background: linear-gradient(to right, #16a34a, #10b981); color: white; text-decoration: none; font-weight: 600; font-size: 15px; display: inline-flex; align-items: center; min-height: 44px; }
    
    /* Container - Mobile First */
    .container { max-width: 1280px; margin: 0 auto; padding: 20px 16px 60px; }
    
    /* Breadcrumb */
    .breadcrumb { font-size: 14px; color: #6b7280; margin-bottom: 20px; }
    .breadcrumb a { color: #6b7280; text-decoration: none; }
    
    /* Product Layout - Mobile First (stacked) */
    .product-layout { display: grid; grid-template-columns: 1fr; gap: 28px; }
    
    /* Product Image - Mobile First */
    .product-image-section { background: white; border-radius: 20px; padding: 40px 20px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); }
    .product-image { background: linear-gradient(to bottom right, #fef3c7, #d1fae5); border-radius: 16px; text-align: center; font-size: 120px; padding: 60px 20px; }
    
    /* Product Info - Mobile First */
    .product-info { background: white; border-radius: 20px; padding: 28px 20px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); }
    
    /* Badges */
    .badges { margin-bottom: 16px; display: flex; flex-wrap: wrap; gap: 10px; }
    .badge { display: inline-block; padding: 8px 16px; background: #16a34a; color: white; border-radius: 20px; font-size: 13px; font-weight: 700; }
    .badge-stock { background: #dcfce7; color: #15803d; }
    
    /* Product Title */
    h1 { font-size: 32px; font-weight: 700; color: #111827; margin-bottom: 16px; font-family: Georgia, serif; line-height: 1.2; }
    
    /* Rating */
    .rating { display: flex; align-items: center; gap: 10px; font-size: 17px; margin-bottom: 20px; font-weight: 600; }
    
    /* Price */
    .price { font-size: 40px; font-weight: 700; color: #16a34a; margin-bottom: 6px; }
    .unit { font-size: 17px; color: #6b7280; margin-bottom: 28px; }
    
    /* Farmer Box */
    .farmer-box { background: #dcfce7; border-radius: 16px; padding: 20px; margin-bottom: 28px; }
    .farmer-title { font-weight: 600; color: #111827; margin-bottom: 16px; font-size: 16px; }
    .farmer-info { display: flex; align-items: center; gap: 16px; }
    .farmer-avatar { width: 72px; height: 72px; background: linear-gradient(to bottom right, #16a34a, #10b981); border-radius: 16px; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; font-weight: 700; }
    .farmer-details { flex: 1; }
    .farmer-name { font-weight: 700; color: #111827; font-size: 19px; margin-bottom: 4px; }
    .farmer-location { color: #6b7280; font-size: 15px; }
    
    /* Product Features */
    .features { margin-bottom: 28px; }
    .feature-item { display: flex; align-items: center; gap: 14px; margin-bottom: 14px; }
    .feature-icon { font-size: 24px; }
    .feature-text { color: #374151; font-size: 16px; }
    
    /* Add to Cart Button - Mobile First */
    .btn-cart { padding: 18px 36px; background: linear-gradient(to right, #16a34a, #10b981); color: white; border: none; border-radius: 14px; font-weight: 700; font-size: 18px; cursor: pointer; width: 100%; margin-bottom: 28px; min-height: 60px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .btn-cart:active { transform: scale(0.98); }
    
    /* Product Details Section */
    .details-section { background: white; border-radius: 16px; padding: 28px 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
    .details-section h3 { font-size: 22px; font-weight: 700; color: #111827; margin-bottom: 16px; }
    .details-section p { color: #6b7280; line-height: 1.8; margin-bottom: 24px; font-size: 16px; }
    .details-section h4 { font-size: 18px; font-weight: 700; color: #111827; margin-bottom: 14px; }
    .details-section ul { color: #374151; line-height: 2; margin-left: 24px; font-size: 16px; }
    
    /* Loading/Error States */
    .loading, .error { text-align: center; padding: 80px 20px; }
    .loading { color: #6b7280; font-size: 17px; }
    .error h2 { font-size: 28px; margin-bottom: 16px; }
    .error p { color: #6b7280; font-size: 16px; }
    
    /* Footer */
    footer { background: #111827; color: white; padding: 40px 16px; text-align: center; margin-top: 60px; }
    .footer-logo { display: inline-flex; align-items: center; gap: 10px; margin-bottom: 16px; }
    
    /* Tablet (640px+) */
    @media (min-width: 640px) {
      h1 { font-size: 38px; }
      .price { font-size: 46px; }
      .product-image { font-size: 140px; padding: 80px 40px; }
    }
    
    /* Desktop (1024px+) */
    @media (min-width: 1024px) {
      nav { padding: 16px 24px; }
      .logo-icon { width: 48px; height: 48px; font-size: 24px; }
      .logo-text h1 { font-size: 24px; }
      .logo-text p { font-size: 10px; letter-spacing: 2px; }
      
      .container { padding: 32px 24px 80px; }
      .product-layout { grid-template-columns: 1fr 1fr; gap: 48px; }
      h1 { font-size: 44px; margin-bottom: 20px; }
      .price { font-size: 52px; }
      .product-image { font-size: 160px; }
      .product-info { padding: 40px; }
      .details-section { padding: 40px; }
    }
  </style>
</head>
<body>
  <nav>
    <div class="nav-content">
      <a href="index.html" class="logo">
        <div class="logo-icon">üå±</div>
        <div class="logo-text"><h1>Kebun Rakyat</h1><p>PASARAN PETANI</p></div>
      </a>
      <a href="marketplace.html" class="btn">‚Üê Back to Marketplace</a>
    </div>
  </nav>

  <div class="container">
    <div class="breadcrumb">
      <a href="index.html">Home</a> / 
      <a href="marketplace.html">Marketplace</a> / 
      <span style="color: #111827; font-weight: 600;" id="breadcrumb">Product</span>
    </div>

    <div id="productContent">
      <div class="loading">Loading product details...</div>
    </div>
  </div>

  <footer>
    <div class="footer-logo">
      <div class="logo-icon">üå±</div><h3 style="font-size: 22px; font-family: Georgia, serif;">Kebun Rakyat</h3>
    </div>
    <p style="color: #9ca3af; font-size: 15px;">Menghubungkan petani dan pembeli untuk masa depan yang lestari</p>
  </footer>

  <script type="module">
    import { db } from './firebase-config.js';
    import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');

    if (!productId) {
      document.getElementById('productContent').innerHTML = `
        <div class="error">
          <h2>Product Not Found</h2>
          <p>No product ID provided.</p>
          <a href="marketplace.html" class="btn" style="margin-top: 24px; display: inline-flex;">Back to Marketplace</a>
        </div>
      `;
    } else {
      loadProduct(productId);
    }

    async function loadProduct(productId) {
      try {
        const productDoc = await getDoc(doc(db, 'products', productId));
        
        if (!productDoc.exists()) {
          document.getElementById('productContent').innerHTML = `
            <div class="error">
              <h2>Product Not Found</h2>
              <p>This product does not exist or has been removed.</p>
              <a href="marketplace.html" class="btn" style="margin-top: 24px; display: inline-flex;">Back to Marketplace</a>
            </div>
          `;
          return;
        }

        const product = productDoc.data();
        
        document.getElementById('breadcrumb').textContent = product.name;
        document.title = `${product.name} - Kebun Rakyat`;

        document.getElementById('productContent').innerHTML = `
          <div class="product-layout">
            <div class="product-image-section">
              <div class="product-image">${product.emoji || 'üåæ'}</div>
            </div>

            <div>
              <div class="product-info">
                <div class="badges">
                  <span class="badge">üõ°Ô∏è Verified Farmer</span>
                  <span class="badge badge-stock">In Stock</span>
                </div>

                <h1>${product.name}</h1>

                <div class="rating">
                  <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                  <span>${(product.rating || 4.5).toFixed(1)}</span>
                  <span style="color: #9ca3af; font-weight: 500;">(${Math.floor(Math.random() * 200 + 50)} reviews)</span>
                </div>

                <div class="price">RM ${product.price.toFixed(2)}</div>
                <div class="unit">per kg</div>

                <div class="farmer-box">
                  <div class="farmer-title">Sold by:</div>
                  <div class="farmer-info">
                    <div class="farmer-avatar">${product.farmerName ? product.farmerName.substring(0, 2).toUpperCase() : 'FM'}</div>
                    <div class="farmer-details">
                      <div class="farmer-name">${product.farmerName || 'Local Farmer'}</div>
                      <div class="farmer-location">üìç ${product.location}</div>
                    </div>
                  </div>
                </div>

                <div class="features">
                  <div class="feature-item">
                    <span class="feature-icon">üåæ</span>
                    <span class="feature-text"><strong>Expected Harvest:</strong> ${product.harvestTime}</span>
                  </div>
                  <div class="feature-item">
                    <span class="feature-icon">üöö</span>
                    <span class="feature-text">Delivery in 1-2 days after harvest</span>
                  </div>
                  <div class="feature-item">
                    <span class="feature-icon">‚è∞</span>
                    <span class="feature-text">Farm-fresh guarantee</span>
                  </div>
                  <div class="feature-item">
                    <span class="feature-icon">üõ°Ô∏è</span>
                    <span class="feature-text">Quality guaranteed or money back</span>
                  </div>
                </div>

                <button class="btn-cart" onclick="addToCart('${productId}', '${product.name}', ${product.price}, '${product.emoji || 'üåæ'}')">
                  üõí Add to Cart
                </button>
              </div>

              <div class="details-section">
                <h3>Product Details</h3>
                <p>${product.description || 'Fresh, quality produce from local farmers. Harvested with care and delivered to your doorstep.'}</p>
                <h4>Key Features:</h4>
                <ul>
                  <li>100% Fresh from local farms</li>
                  <li>Harvested within 24-48 hours</li>
                  <li>No middlemen - direct from farmer</li>
                  <li>Quality guaranteed</li>
                </ul>
              </div>
            </div>
          </div>
        `;

      } catch (error) {
        document.getElementById('productContent').innerHTML = `
          <div class="error">
            <h2>Error Loading Product</h2>
            <p>${error.message}</p>
            <a href="marketplace.html" class="btn" style="margin-top: 24px; display: inline-flex;">Back to Marketplace</a>
          </div>
        `;
      }
    }

    window.addToCart = (id, name, price, emoji) => {
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      cart.push({ id, name, price, emoji });
      localStorage.setItem('cart', JSON.stringify(cart));
      alert(`${emoji} ${name} added to cart!`);
    };
  </script>
</body>
</html>