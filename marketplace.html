<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marketplace - Kebun Rakyat</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body { background: linear-gradient(to bottom right, #fef3c7, #ffffff, #d1fae5); min-height: 100vh; }
    nav { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); padding: 16px 24px; }
    .nav-content { max-width: 1280px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
    .logo { display: flex; align-items: center; gap: 12px; text-decoration: none; }
    .logo-icon { width: 48px; height: 48px; background: linear-gradient(to bottom right, #16a34a, #10b981); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
    .logo-text h1 { font-size: 24px; font-weight: 700; background: linear-gradient(to right, #15803d, #059669); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-family: Georgia, serif; }
    .logo-text p { font-size: 10px; color: #16a34a; font-weight: 600; letter-spacing: 2px; }
    .nav-links { display: flex; gap: 32px; align-items: center; }
    .nav-links a { color: #374151; text-decoration: none; font-weight: 500; font-size: 14px; }
    .btn { padding: 10px 24px; border-radius: 9999px; font-weight: 600; text-decoration: none; background: linear-gradient(to right, #16a34a, #10b981); color: white; display: inline-block; position: relative; }
    .cart-badge { position: absolute; top: -8px; right: -8px; background: #dc2626; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; align-items: center; justify-content: center; }
    .hero-banner { background: linear-gradient(to right, #16a34a, #10b981); color: white; padding: 80px 24px 48px; text-align: center; }
    .hero-banner h1 { font-size: 48px; font-weight: 700; margin-bottom: 16px; font-family: Georgia, serif; }
    .container { max-width: 1280px; margin: 0 auto; padding: 48px 24px; }
    .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 24px; }
    .product-card { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); transition: all 0.3s; }
    .product-card:hover { transform: translateY(-8px); box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15); }
    .product-card a { display: block; }
    .product-image { background: linear-gradient(to bottom right, #fef3c7, #d1fae5); padding: 48px; text-align: center; font-size: 80px; }
    .product-info { padding: 20px; }
    .product-name { font-size: 18px; font-weight: 700; color: #1f2937; margin-bottom: 8px; }
    .product-farmer { font-size: 14px; color: #6b7280; margin-bottom: 12px; }
    .harvest-time { font-size: 12px; color: #15803d; background: #dcfce7; padding: 4px 10px; border-radius: 6px; display: inline-block; margin-bottom: 12px; font-weight: 600; }
    .product-rating { display: flex; align-items: center; gap: 4px; font-size: 14px; margin-bottom: 12px; }
    .product-location { font-size: 13px; color: #6b7280; margin-bottom: 16px; }
    .product-price { font-size: 28px; font-weight: 700; color: #16a34a; margin-bottom: 4px; }
    .product-unit { font-size: 13px; color: #6b7280; margin-bottom: 16px; }
    .btn-add-cart { width: 100%; padding: 12px; background: linear-gradient(to right, #16a34a, #10b981); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
    .loading { text-align: center; padding: 48px; color: #6b7280; }
    footer { background: #111827; color: white; padding: 48px 24px; text-align: center; margin-top: 80px; }
    @media (max-width: 768px) { .nav-links { display: none; } .hero-banner h1 { font-size: 32px; } }
  </style>
</head>
<body>
  <nav>
    <div class="nav-content">
      <a href="index.html" class="logo">
        <div class="logo-icon">üå±</div>
        <div class="logo-text"><h1>Kebun Rakyat</h1><p>PASARAN PETANI</p></div>
      </a>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="marketplace-working.html" style="color: #16a34a; font-weight: 700;">Marketplace</a>
        <a href="about.html">About Us</a>
      </div>
      <a href="#" class="btn" onclick="viewCart()">üõí Cart <span class="cart-badge" id="cartCount">0</span></a>
    </div>
  </nav>

  <div class="hero-banner">
    <h1>Fresh Produce Marketplace</h1>
    <p style="font-size: 20px; color: #d1fae5; margin-bottom: 16px;">Browse products from verified farmers across Malaysia</p>
  </div>

  <div class="container">
    <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 24px;"><span id="productCount">Loading</span> Products Found</h2>
    <div id="productsList" class="products-grid">
      <div class="loading">Loading products from farmers...</div>
    </div>
  </div>

  <footer>
    <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 16px;">
      <div class="logo-icon">üå±</div><h3 style="font-size: 24px; font-family: Georgia, serif;">Kebun Rakyat</h3>
    </div>
    <p style="color: #9ca3af;">Menghubungkan petani dan pembeli untuk masa depan yang lestari</p>
    <div style="margin-top: 32px; padding-top: 32px; border-top: 1px solid #374151; color: #6b7280; font-size: 14px;">¬© 2026 Kebun Rakyat. Hak cipta terpelihara.</div>
  </footer>

  <script type="module">
    import { db } from './firebase-config.js';
    import { collection, getDocs, addDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    updateCartCount();

    // Load products from Firebase
    async function loadProducts() {
      const productsList = document.getElementById('productsList');
      
      try {
        const snapshot = await getDocs(collection(db, 'products'));
        
        if (snapshot.empty) {
          productsList.innerHTML = '<div class="loading">No products available yet. Farmers can add products!</div>';
          document.getElementById('productCount').textContent = '0';
          return;
        }

        document.getElementById('productCount').textContent = snapshot.size;
        productsList.innerHTML = '';
        
        snapshot.forEach(doc => {
          const product = doc.data();
          const productCard = document.createElement('div');
          productCard.className = 'product-card';
          productCard.innerHTML = `
            <a href="product.html?id=${doc.id}" style="text-decoration: none; color: inherit;">
              <div class="product-image">${product.emoji || 'üåæ'}</div>
              <div class="product-info">
                <h3 class="product-name">${product.name}</h3>
                <p class="product-farmer">${product.farmerName}</p>
                <div class="harvest-time">üåæ Harvest: ${product.harvestTime}</div>
                <div class="product-rating">‚≠ê ${product.rating.toFixed(1)} <span style="color: #9ca3af;">(${Math.floor(Math.random() * 200)})</span></div>
                <p class="product-location">üìç ${product.location}</p>
                <div class="product-price">RM ${product.price.toFixed(2)}</div>
                <div class="product-unit">per kg</div>
              </div>
            </a>
            <div style="padding: 0 20px 20px;">
              <button class="btn-add-cart" onclick="event.stopPropagation(); addToCart('${doc.id}', '${product.name}', ${product.price}, '${product.emoji}')">üõí Add to Cart</button>
            </div>
          `;
          productsList.appendChild(productCard);
        });
      } catch (error) {
        productsList.innerHTML = '<div class="loading" style="color: #dc2626;">Error loading products: ' + error.message + '</div>';
      }
    }

    window.addToCart = (id, name, price, emoji) => {
      cart.push({ id, name, price, emoji });
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCount();
      alert(`${emoji} ${name} added to cart!`);
    };

    function updateCartCount() {
      document.getElementById('cartCount').textContent = cart.length;
    }

    window.viewCart = async () => {
      if (cart.length === 0) {
        alert('Your cart is empty!');
        return;
      }

      const total = cart.reduce((sum, item) => sum + item.price, 0);
      const items = cart.map(item => `${item.emoji} ${item.name} - RM ${item.price.toFixed(2)}`).join('\n');
      
      if (confirm(`Your Cart:\n\n${items}\n\nTotal: RM ${total.toFixed(2)}\n\nSimulate purchase?`)) {
        try {
          // Save order to Firebase
          await addDoc(collection(db, 'orders'), {
            items: cart,
            total: total,
            status: 'completed',
            createdAt: new Date()
          });

          alert('üéâ Order placed successfully! (Demo simulation)');
          cart = [];
          localStorage.setItem('cart', JSON.stringify(cart));
          updateCartCount();
        } catch (error) {
          alert('Error placing order: ' + error.message);
        }
      }
    };

    // Load products on page load
    loadProducts();
  </script>
</body>
</html>