<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign In - Kebun Rakyat</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body { background: linear-gradient(to bottom right, #fef3c7, #ffffff, #d1fae5); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 24px; }
    .back-link { position: fixed; top: 24px; left: 24px; display: flex; align-items: center; gap: 12px; text-decoration: none; }
    .logo-icon { width: 48px; height: 48px; background: linear-gradient(to bottom right, #16a34a, #10b981); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
    .logo-text h1 { font-size: 24px; font-weight: 700; background: linear-gradient(to right, #15803d, #059669); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-family: Georgia, serif; }
    .logo-text p { font-size: 10px; color: #16a34a; font-weight: 600; letter-spacing: 2px; }
    .login-container { max-width: 900px; background: white; border-radius: 24px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15); display: grid; grid-template-columns: 1fr 1fr; overflow: hidden; }
    .login-side { background: linear-gradient(to bottom right, #16a34a, #10b981); color: white; padding: 48px; display: flex; flex-direction: column; justify-content: center; }
    .login-side h2 { font-size: 36px; font-weight: 700; margin-bottom: 24px; font-family: Georgia, serif; }
    .login-side p { font-size: 18px; color: #d1fae5; line-height: 1.6; }
    .form-side { padding: 48px; }
    .form-side h2 { font-size: 32px; font-weight: 700; color: #111827; margin-bottom: 8px; }
    .form-side p { color: #6b7280; margin-bottom: 32px; }
    .form-side a { color: #16a34a; font-weight: 600; text-decoration: none; }
    .form-group { margin-bottom: 24px; }
    label { display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px; }
    input { width: 100%; padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; outline: none; transition: border-color 0.3s; }
    input:focus { border-color: #16a34a; }
    .btn { width: 100%; padding: 16px; background: linear-gradient(to right, #16a34a, #10b981); color: white; border: none; border-radius: 12px; font-weight: 700; font-size: 16px; cursor: pointer; transition: all 0.3s; }
    .btn:hover { box-shadow: 0 10px 30px rgba(22, 163, 74, 0.3); transform: scale(1.02); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .error { background: #fee2e2; color: #dc2626; padding: 12px; border-radius: 8px; margin-bottom: 16px; font-size: 14px; }
    .success { background: #dcfce7; color: #16a34a; padding: 12px; border-radius: 8px; margin-bottom: 16px; font-size: 14px; }
    .tabs { display: flex; gap: 16px; margin-bottom: 32px; border-bottom: 2px solid #e5e7eb; }
    .tab { padding: 12px 24px; cursor: pointer; font-weight: 600; color: #6b7280; border-bottom: 3px solid transparent; margin-bottom: -2px; }
    .tab.active { color: #16a34a; border-bottom-color: #16a34a; }
    @media (max-width: 768px) { 
      body { padding: 12px; }
      .back-link { position: static; margin-bottom: 24px; }
      .login-container { grid-template-columns: 1fr; max-width: 100%; }
      .login-side { display: none; }
      .form-side { padding: 32px 24px; }
      .form-side h2 { font-size: 24px; }
      input, select { font-size: 16px; }
      .btn { padding: 14px; font-size: 15px; }
    }
  </style>
</head>
<body>
  <a href="index.html" class="back-link">
    <div class="logo-icon">ðŸŒ±</div>
    <div class="logo-text"><h1>Kebun Rakyat</h1><p>PASARAN PETANI</p></div>
  </a>

  <div class="login-container">
    <div class="login-side">
      <h2>Welcome Back!</h2>
      <p>Connect with thousands of farmers and discover fresh, quality produce directly from the source.</p>
      <div style="margin-top: 32px;">
        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
          <div style="width: 48px; height: 48px; background: rgba(255, 255, 255, 0.2); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px;">ðŸŒ±</div>
          <div>
            <div style="font-weight: 600; font-size: 18px;">Fresh from Farm</div>
            <div style="color: #d1fae5; font-size: 14px;">Direct connections, zero middlemen</div>
          </div>
        </div>
        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
          <div style="width: 48px; height: 48px; background: rgba(255, 255, 255, 0.2); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px;">âœ…</div>
          <div>
            <div style="font-weight: 600; font-size: 18px;">Verified Quality</div>
            <div style="color: #d1fae5; font-size: 14px;">All farmers are verified for authenticity</div>
          </div>
        </div>
        <div style="display: flex; align-items: center; gap: 16px;">
          <div style="width: 48px; height: 48px; background: rgba(255, 255, 255, 0.2); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px;">ðŸ’°</div>
          <div>
            <div style="font-weight: 600; font-size: 18px;">Best Prices</div>
            <div style="color: #d1fae5; font-size: 14px;">Fair pricing for farmers and buyers</div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-side">
      <div class="tabs">
        <div class="tab active" onclick="switchTab('login')">Sign In</div>
        <div class="tab" onclick="switchTab('signup')">Sign Up</div>
      </div>

      <div id="message"></div>

      <!-- LOGIN FORM -->
      <form id="loginForm">
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="loginEmail" placeholder="Enter your email" required>
        </div>

        <div class="form-group">
          <label>Password</label>
          <input type="password" id="loginPassword" placeholder="Enter your password" required>
        </div>

        <button type="submit" class="btn" id="loginBtn">Sign In</button>
      </form>

      <!-- SIGNUP FORM -->
      <form id="signupForm" style="display: none;">
        <div class="form-group">
          <label>User Type</label>
          <select id="userRole" style="width: 100%; padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; outline: none;">
            <option value="customer">Customer</option>
            <option value="farmer">Farmer</option>
            <option value="admin">Admin (Ministry)</option>
          </select>
        </div>

        <div class="form-group" id="farmNameGroup" style="display: none;">
          <label>Farm Name</label>
          <input type="text" id="farmName" placeholder="Enter your farm name">
        </div>

        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="signupEmail" placeholder="Enter your email" required>
        </div>

        <div class="form-group">
          <label>Password</label>
          <input type="password" id="signupPassword" placeholder="At least 6 characters" required>
        </div>

        <button type="submit" class="btn" id="signupBtn">Create Account</button>
      </form>
    </div>
  </div>

  <script type="module">
    import { auth, db } from './firebase-config.js';
    import { signInWithEmailAndPassword, createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
    import { doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    // Show/hide farm name field based on user role
    document.getElementById('userRole').addEventListener('change', (e) => {
      const farmNameGroup = document.getElementById('farmNameGroup');
      if (e.target.value === 'farmer') {
        farmNameGroup.style.display = 'block';
      } else {
        farmNameGroup.style.display = 'none';
      }
    });

    // LOGIN
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      const btn = document.getElementById('loginBtn');
      
      btn.disabled = true;
      btn.textContent = 'Signing in...';

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        
        // Get user role from database
        const userDoc = await getDoc(doc(db, 'users', userCredential.user.uid));
        const userRole = userDoc.exists() ? userDoc.data().role : 'customer';
        
        showMessage('Success! Redirecting...', 'success');
        
        // Redirect based on role
        setTimeout(() => {
          if (userRole === 'admin') {
            window.location.href = 'admin.html';
          } else if (userRole === 'farmer') {
            window.location.href = 'dashboard.html';
          } else {
            window.location.href = 'marketplace.html';
          }
        }, 1000);
      } catch (error) {
        showMessage(error.message, 'error');
        btn.disabled = false;
        btn.textContent = 'Sign In';
      }
    });

    // SIGNUP
    document.getElementById('signupForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      const role = document.getElementById('userRole').value;
      const farmName = document.getElementById('farmName').value;
      const btn = document.getElementById('signupBtn');
      
      btn.disabled = true;
      btn.textContent = 'Creating account...';

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        
        // Save user data to Firestore
        await setDoc(doc(db, 'users', userCredential.user.uid), {
          email: email,
          role: role,
          farmName: role === 'farmer' ? farmName : null,
          createdAt: new Date()
        });

        showMessage('Account created! Redirecting...', 'success');
        
        setTimeout(() => {
          if (role === 'admin') {
            window.location.href = 'admin.html';
          } else if (role === 'farmer') {
            window.location.href = 'dashboard.html';
          } else {
            window.location.href = 'marketplace.html';
          }
        }, 1000);
      } catch (error) {
        showMessage(error.message, 'error');
        btn.disabled = false;
        btn.textContent = 'Create Account';
      }
    });

    function showMessage(msg, type) {
      const messageDiv = document.getElementById('message');
      messageDiv.className = type;
      messageDiv.textContent = msg;
      messageDiv.style.display = 'block';
    }

    window.switchTab = (tab) => {
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(t => t.classList.remove('active'));
      
      if (tab === 'login') {
        tabs[0].classList.add('active');
        document.getElementById('loginForm').style.display = 'block';
        document.getElementById('signupForm').style.display = 'none';
      } else {
        tabs[1].classList.add('active');
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('signupForm').style.display = 'block';
      }
      
      document.getElementById('message').style.display = 'none';
    };
  </script>
</body>
</html>